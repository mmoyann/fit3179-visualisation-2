{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "title": "Global Temperature Anomalies (째C)",
  "width": 1000,
  "height": 420,

  "data": { "url": "anomalies.csv" },

  "params": [
    {
      "name": "FromYear",
      "value": 1850,
      "bind": { "input": "range", "min": 1850, "max": 2025, "step": 1, "name": "From year:" }
    }
  ],

  "transform": [
    { "calculate": "toNumber(datum.Year)", "as": "YearNum" },
    { "calculate": "toNumber(datum.Anomaly)", "as": "Anom" },
    { "filter": "datum.YearNum >= FromYear" },
    {
      "window": [{ "op": "mean", "field": "Anom", "as": "MA10" }],
      "frame": [-9, 0],
      "sort": [{ "field": "YearNum" }]
    }
  ],

  "layer": [
    {
      "mark": { "type": "rule", "strokeDash": [4, 4], "opacity": 0.6 },
      "encoding": { "y": { "value": 0 } }
    },
    {
      "mark": { "type": "rule", "strokeDash": [6, 4], "opacity": 0.4 },
      "encoding": { "y": { "value": 1.5 } }
    },
    {
      "mark": { "type": "line", "interpolate": "monotone", "color": "#377eb8" },
      "encoding": {
        "x": {
          "field": "YearNum",
          "type": "quantitative",
          "title": "Year",
          "axis": { "tickCount": 10 }
        },
        "y": {
          "field": "Anom",
          "type": "quantitative",
          "title": "Temperature Anomaly (째C)",
          "axis": { "titleFontWeight": "bold", "labelFont": "Inter" }
        }
      }
    },
    {
      "mark": { "type": "line", "strokeWidth": 2, "color": "#d62728" },
      "encoding": {
        "x": { "field": "YearNum", "type": "quantitative" },
        "y": {
          "field": "MA10",
          "type": "quantitative",
          "title": null
        }
      }
    },
    {
      "mark": { "type": "circle", "size": 35, "opacity": 0.9, "color": "#377eb8" },
      "encoding": {
        "x": { "field": "YearNum", "type": "quantitative" },
        "y": { "field": "Anom", "type": "quantitative" },
        "tooltip": [
          { "field": "YearNum", "title": "Year" },
          { "field": "Anom", "title": "Anomaly (째C)", "format": ".2f" },
          { "field": "MA10", "title": "10-Year Mean (째C)", "format": ".2f" }
        ]
      }
    }
  ]
}
