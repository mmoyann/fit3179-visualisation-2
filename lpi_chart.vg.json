{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "title": "Global Living Planet Index (1970 = 1)",
  "width": 1000,
  "height": 420,
  "data": { "url": "global-living-planet-index.csv" },

  "params": [
    { "name": "FromYear", "value": 1970,
      "bind": {"input":"range","min":1970,"max":2020,"step":1,"name":"From year: "} },
    { "name": "hover", "select": { "type": "point", "fields": ["YearNum"], "nearest": true, "on": "pointerover", "clear": "pointerout" } }
  ],

  "transform": [
    {"filter":"datum.Entity == 'World'"},
    {"calculate":"toNumber(datum.Year)","as":"YearNum"},
    {"filter":"datum.YearNum >= FromYear"},
    {"calculate":"toNumber(datum['Living Planet Index'])","as":"LPI"},
    {"calculate":"datum.LPI * 100","as":"LPI_1970eq100"},
    {"calculate":"'Year: ' + toString(datum.YearNum) + ' â€” ' + format(datum.LPI_1970eq100, '.0f')","as":"hoverLabel"}
  ],

  "layer": [
    { "mark": {"type":"rule","strokeDash":[4,4],"opacity":0.5}, "encoding": { "y": {"value": 100 } } },

    { "mark": {"type":"line","strokeWidth":2,"color":"#2ca02c"},
      "encoding": {
        "x": {"field":"YearNum","type":"quantitative","title":"Year","axis":{"tickCount":10}},
        "y": {"field":"LPI_1970eq100","type":"quantitative","title":"Index (1970 = 100)","scale":{"zero":false}}
      }
    },

    { "mark": {"type":"circle","size":36,"opacity":0.85,"color":"#2ca02c"},
      "encoding": {
        "x": {"field":"YearNum","type":"quantitative"},
        "y": {"field":"LPI_1970eq100","type":"quantitative"},
        "opacity": {"condition":{"param":"hover","value":1},"value":0.1},
        "tooltip": [
          {"field":"YearNum","title":"Year"},
          {"field":"LPI","type":"quantitative","format":".3f","title":"Index (1970 = 1)"},
          {"field":"LPI_1970eq100","type":"quantitative","format":".0f","title":"Index (1970 = 100)"}
        ]
      },
      "params":[{"name":"hover"}]
    },

    { "transform":[{"filter":{"param":"hover"}}],
      "mark":{"type":"rule","strokeDash":[4,4],"opacity":0.5},
      "encoding":{"x":{"field":"YearNum","type":"quantitative"}}
    },

    { "transform":[{"filter":{"param":"hover"}}],
      "mark":{"type":"text","dx":6,"dy":-6,"fontStyle":"italic"},
      "encoding":{"x":{"field":"YearNum"},"y":{"field":"LPI_1970eq100"},"text":{"field":"hoverLabel"}}
    }
  ],

  "config": { "axis": {"labelFont": "Inter", "titleFont": "Inter"}, "view": {"stroke": null} }
}
